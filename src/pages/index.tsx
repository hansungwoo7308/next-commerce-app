import Head from "next/head";
import SlickSlider from "@/components/performance/SlickSlider";
import { styled } from "styled-components";
import connectDB from "lib/server/config/connectDB";
import Product from "lib/server/models/Product";
import Image from "next/image";
import Link from "next/link";

export async function getServerSideProps({ req, query }: any) {
  console.log(`\x1b[33m\n[${req.url}]:::[${req.method}]\x1b[30m`);
  // console.log({ "Object.keys(req)": Object.keys(req) });
  // console.log({ "Object.entries(req)": Object.entries(req) });

  await connectDB();
  let randomProducts: any;
  let recentProducts: any;
  randomProducts = await Product.aggregate([{ $sample: { size: 10 } }]).exec();
  recentProducts = await Product.aggregate([{ $sort: { createdAt: -1 } }, { $limit: 10 }]).exec();
  const products = { randomProducts, recentProducts };
  console.log({ products });

  return { props: { products: JSON.parse(JSON.stringify(products)) } };
}

const data = [
  "/images/slide-01.jpg",
  "/images/slide-02.jpg",
  "/images/slide-01.jpg",
  "/images/slide-02.jpg",
  "/images/slide-01.jpg",
  "/images/slide-02.jpg",
];

export default function Home({ products }: any) {
  console.log({ products });
  const { randomProducts, recentProducts } = products;

  return (
    <>
      <Head>
        <title>Youser Stack E-Commerce</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Main>
        <section className="hero">
          <SlickSlider imageUrls={data} />
          <div className="hero-category">
            <div className="card">
              <h1>Electronics</h1>
              <Link href={"/shop/all?category=electronics"}>
                <Image
                  src={"/images/category/electronics.jpg"}
                  alt="alt"
                  width={300}
                  height={300}
                />
              </Link>
            </div>
            <div className="card">
              <h1>Furnitures</h1>
              <Link href={"/shop/all?category=furnitures"}>
                <Image src={"/images/category/furnitures.jpg"} alt="alt" width={300} height={300} />
              </Link>
            </div>
            <div className="card">
              <h1>Cosmetics</h1>
              <Link href={"/shop/all?category=cosmetics"}>
                <Image src={"/images/category/cosmetics.jpg"} alt="alt" width={300} height={300} />
              </Link>
            </div>
            <div className="card">
              <h1>Fashion</h1>
              <Link href={"/shop/all?category=fashion"}>
                <Image src={"/images/category/fashion.jpg"} alt="alt" width={300} height={300} />
              </Link>
            </div>
          </div>
          {/* <ul className="hero-category">
            {products.map((product: any) => (
              <li className="card">
                <Image src={product.images[0].url} alt="alt" width={300} height={300} />
                <h1>{product.name}</h1>
              </li>
            ))}
          </ul> */}
          <div className="best-sellers">
            <h1>Best Sellers</h1>
            {randomProducts && (
              <SlickSlider
                imageUrls={randomProducts.map((product: any) => product.images[0].url)}
                multipleItemNumber={3}
                actionType="VIEW_IMAGE"
                dots={false}
                settings={{}}
              />
            )}
          </div>
          <div className="new-arrivals">
            <h1>New Arrivals</h1>
            {recentProducts && (
              <SlickSlider
                imageUrls={recentProducts.map((product: any) => product.images[0].url)}
                multipleItemNumber={4}
                actionType="VIEW_IMAGE"
                dots={false}
                settings={{}}
              />
            )}
          </div>
          <div className="recommendations">
            <h1>Recommendations</h1>
          </div>
        </section>
        <section></section>
        <section></section>
        <section></section>
      </Main>
    </>
  );
}
const Main = styled.main`
  .hero {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    .hero-category,
    .best-sellers,
    .new-arrivals,
    .recommendations {
      background-color: #333;
      padding: 1rem;
      > h1 {
        margin-bottom: 10px;
      }
    }
    .hero-category {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(auto, 200px));
      justify-content: center;
      gap: 1rem;
      background-color: #333;
      padding: 1rem;
      .card {
        height: 200px;
        background-color: #fff;
        color: #000;
        overflow: hidden;
        padding: 1rem;
        display: flex;
        flex-direction: column;
        a {
          overflow: hidden;
        }

        /* .img-outer {
          overflow: hidden;
        } */
      }
    }
    .best-sellers {
      .slick-slide {
        padding: 0 1rem;
      }
    }
    .new-arrivals {
      .slick-slide {
        padding: 0 1rem;
      }
    }
  }
`;
